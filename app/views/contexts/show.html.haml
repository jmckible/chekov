%h2= link_to @context.name, [:edit, @context]

%p= @context.description

= form_tag @context, :method=>:get do
  %p
    %select{name: 'user_id'}
      %option{value: ''} Everyone
      - User.all.each do |u|
        - options = {value: u.id}
        - options[:selected] = 'selected' if u == @user
        %option{options}= u.name
    = submit_tag 'Show'

%table.data
  %tr
    %th Story
    - @context.browsers.each do |browser|
      %th= browser
    %th Blended
  - @context.stories.each do |story|
    %tr
      %td= link_to story.name, [@context, story]
      - @context.browsers.each do |browser|
        - color = {class: 'clickable'}
        - color[:style] = "background-color: #{colorize story.passed_for(browser, @user)}" unless story.suites.for_browser(browser).count == 0 
        %td{color}= link_to story.passed_for(browser, @user), new_context_story_suite_path(@context, story, 'suite[browser]'=>browser)
      %td.strong{style: "background-color: #{colorize story.passed_blended(@user)}"}= story.passed_blended(@user)
  %tr.strong
    %td Total
    - @context.browsers.each do |browser|
      %td{style: "background-color: #{colorize @context.passed_for(browser, @user)}"}= @context.passed_for browser, @user
    %td{style: "background-color: #{colorize @context.passed_blended(@user)}"}= @context.passed_blended(@user)
    
%p= link_to 'New Story', new_context_story_path(@context)


%br
%br
%table.data
  %tr
    %th User
    - @context.browsers.each do |browser|
      %th= browser  
  - User.all.each do |user|
    %tr
      %td= user.name
      - @context.browsers.each do |browser|
        %td
          = form_for Assignment.new, remote: true do |f|
            = hidden_field_tag :context_id, @context.id
            = hidden_field_tag :user_id, user.id
            = hidden_field_tag :browser, browser
            = check_box_tag 'assignment', 'true', user.assigned?(@context, browser), user_id: user.id, context_id: @context.id, browser: browser, class: 'assignment'
          
